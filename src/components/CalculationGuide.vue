<template>
  <div class="calculation-guide">
    <div class="guide-header" @click="toggleExpanded">
      <h2>ğŸ“š è®¡ç®—å…¬å¼ä¸çŸ¥è¯†è¯´æ˜</h2>
      <span class="toggle-icon" :class="{ expanded: isExpanded }">â–¼</span>
    </div>

    <div v-if="isExpanded" class="guide-content">
      <!-- åŸºç¡€è®¡ç®—å…¬å¼ -->
      <section class="guide-section">
        <h3>1. åŸºç¡€è®¡ç®—å…¬å¼</h3>
        
        <div class="formula-group">
          <h4>æ¶¨åœä»·æ ¼</h4>
          <div class="formula-box">
            <code>æ¶¨åœä»· = floor(åŸºå‡†ä»· Ã— (1 + æ¶¨è·Œåœæ¯”ä¾‹/100)) Ã— 10000 / 10000</code>
          </div>
          <p class="formula-note">ä½¿ç”¨å‘ä¸‹å–æ•´ï¼Œä¿ç•™4ä½å°æ•°</p>
        </div>

        <div class="formula-group">
          <h4>è·Œåœä»·æ ¼</h4>
          <div class="formula-box">
            <code>è·Œåœä»· = ceil(åŸºå‡†ä»· Ã— (1 - æ¶¨è·Œåœæ¯”ä¾‹/100)) Ã— 10000 / 10000</code>
          </div>
          <p class="formula-note">ä½¿ç”¨å‘ä¸Šå–æ•´ï¼Œä¿ç•™4ä½å°æ•°</p>
        </div>

        <div class="formula-group">
          <h4>å¸‚å€¼è®¡ç®—</h4>
          <div class="formula-box">
            <code>å¸‚å€¼ = æŒä»“æ•°é‡ Ã— å½“å‰ä»·æ ¼</code>
          </div>
        </div>

        <div class="formula-group">
          <h4>ç›ˆäºè®¡ç®—</h4>
          <div class="formula-box">
            <code>ç›ˆäº = å¸‚å€¼ - æ€»æˆæœ¬</code>
            <br>
            <code>æ€»æˆæœ¬ = æŒä»“æ•°é‡ Ã— æˆæœ¬ä»·</code>
          </div>
        </div>

        <div class="formula-group">
          <h4>ç›ˆäºæ¯”ä¾‹</h4>
          <div class="formula-box">
            <code>ç›ˆäºæ¯”ä¾‹ = (å½“å‰ä»·æ ¼ - æˆæœ¬ä»·) / æˆæœ¬ä»· Ã— 100%</code>
          </div>
          <p class="formula-note">ç›ˆäºæ¯”ä¾‹å§‹ç»ˆç›¸å¯¹äºåˆå§‹æˆæœ¬ä»·è®¡ç®—</p>
        </div>
      </section>

      <!-- è¿ç»­æ¶¨è·ŒåœåŸç† -->
      <section class="guide-section">
        <h3>2. è¿ç»­æ¶¨è·ŒåœåŸç†</h3>
        
        <div class="principle-box">
          <h4>åŸºå‡†ä»·æ›´æ–°é€»è¾‘</h4>
          <ul>
            <li><strong>æ¶¨åœè·¯å¾„ï¼š</strong>æ¯å¤©çš„åŸºå‡†ä»· = å‰ä¸€å¤©çš„æ¶¨åœä»·</li>
            <li><strong>è·Œåœè·¯å¾„ï¼š</strong>æ¯å¤©çš„åŸºå‡†ä»· = å‰ä¸€å¤©çš„è·Œåœä»·</li>
            <li>ä¸¤æ¡è·¯å¾„ç‹¬ç«‹è®¡ç®—ï¼Œäº’ä¸å½±å“</li>
          </ul>
        </div>

        <div class="principle-box">
          <h4>å¤åˆ©æ•ˆåº”å…¬å¼</h4>
          <div class="formula-box">
            <code>è¿ç»­Nå¤©æ¶¨åœï¼šä»·æ ¼_N = åˆå§‹ä»· Ã— (1 + æ¶¨è·Œåœæ¯”ä¾‹/100)^N</code>
            <br>
            <code>è¿ç»­Nå¤©è·Œåœï¼šä»·æ ¼_N = åˆå§‹ä»· Ã— (1 - æ¶¨è·Œåœæ¯”ä¾‹/100)^N</code>
          </div>
          <p class="formula-note">è¿™æ˜¯å¤åˆ©è®¡ç®—ï¼Œä»·æ ¼å˜åŒ–å‘ˆæŒ‡æ•°å¢é•¿æˆ–ä¸‹é™</p>
        </div>

        <div class="principle-box">
          <h4>è¿ç»­è·Œåœåç›ˆäºæ¯”ä¾‹</h4>
          <div class="formula-box">
            <code>ç›ˆäºæ¯”ä¾‹_N = [(1 - æ¶¨è·Œåœæ¯”ä¾‹/100)^N - 1] Ã— 100%</code>
          </div>
          <p class="formula-note">å‡è®¾æˆæœ¬ä»· = åˆå§‹ä»·</p>
        </div>
      </section>

      <!-- è®¡ç®—ç¤ºä¾‹ -->
      <section class="guide-section">
        <h3>3. è®¡ç®—ç¤ºä¾‹</h3>
        <p class="example-intro">å‡è®¾ï¼šæˆæœ¬ä»· = 10.0000ï¼Œç°ä»· = 10.0000ï¼Œæ¶¨è·Œåœæ¯”ä¾‹ = 10%ï¼ŒæŒä»“ = 1000è‚¡</p>

        <div class="example-table-container">
          <h4>è¿ç»­æ¶¨åœç¤ºä¾‹</h4>
          <table class="example-table">
            <thead>
              <tr>
                <th>å¤©æ•°</th>
                <th>åŸºå‡†ä»·</th>
                <th>æ¶¨åœä»·</th>
                <th>å¸‚å€¼</th>
                <th>ç›ˆäº</th>
                <th>ç›ˆäºæ¯”ä¾‹</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>åˆå§‹</td>
                <td>10.0000</td>
                <td>-</td>
                <td>10,000.0000</td>
                <td>0.0000</td>
                <td>0%</td>
              </tr>
              <tr>
                <td>ç¬¬1å¤©</td>
                <td>10.0000</td>
                <td>11.0000</td>
                <td>11,000.0000</td>
                <td>+1,000.0000</td>
                <td class="positive">+10%</td>
              </tr>
              <tr>
                <td>ç¬¬2å¤©</td>
                <td>11.0000</td>
                <td>12.1000</td>
                <td>12,100.0000</td>
                <td>+2,100.0000</td>
                <td class="positive">+21%</td>
              </tr>
              <tr>
                <td>ç¬¬3å¤©</td>
                <td>12.1000</td>
                <td>13.3100</td>
                <td>13,310.0000</td>
                <td>+3,310.0000</td>
                <td class="positive">+33.1%</td>
              </tr>
              <tr>
                <td>ç¬¬5å¤©</td>
                <td>14.6410</td>
                <td>16.1051</td>
                <td>16,105.1000</td>
                <td>+6,105.1000</td>
                <td class="positive">+61.05%</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="example-table-container">
          <h4>è¿ç»­è·Œåœç¤ºä¾‹</h4>
          <table class="example-table">
            <thead>
              <tr>
                <th>å¤©æ•°</th>
                <th>åŸºå‡†ä»·</th>
                <th>è·Œåœä»·</th>
                <th>å¸‚å€¼</th>
                <th>ç›ˆäº</th>
                <th>ç›ˆäºæ¯”ä¾‹</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>åˆå§‹</td>
                <td>10.0000</td>
                <td>-</td>
                <td>10,000.0000</td>
                <td>0.0000</td>
                <td>0%</td>
              </tr>
              <tr>
                <td>ç¬¬1å¤©</td>
                <td>10.0000</td>
                <td>9.0000</td>
                <td>9,000.0000</td>
                <td>-1,000.0000</td>
                <td class="negative">-10%</td>
              </tr>
              <tr>
                <td>ç¬¬2å¤©</td>
                <td>9.0000</td>
                <td>8.1000</td>
                <td>8,100.0000</td>
                <td>-1,900.0000</td>
                <td class="negative">-19%</td>
              </tr>
              <tr>
                <td>ç¬¬3å¤©</td>
                <td>8.1000</td>
                <td>7.2900</td>
                <td>7,290.0000</td>
                <td>-2,710.0000</td>
                <td class="negative">-27.1%</td>
              </tr>
              <tr>
                <td>ç¬¬5å¤©</td>
                <td>6.5610</td>
                <td>5.9049</td>
                <td>5,904.9000</td>
                <td>-4,095.1000</td>
                <td class="negative">-40.95%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- é‡‘èçŸ¥è¯† -->
      <section class="guide-section">
        <h3>4. é‡‘èçŸ¥è¯†</h3>
        
        <div class="knowledge-box">
          <h4>ä¸ºä»€ä¹ˆäºæŸä¼š"æˆå€æ•°å¢é•¿"ï¼Ÿ</h4>
          <p>è¿ç»­è·Œåœæ—¶ï¼ŒäºæŸçœ‹èµ·æ¥"æˆå€æ•°å¢é•¿"çš„åŸå› ï¼š</p>
          <ul>
            <li><strong>å¤åˆ©æ•ˆåº”ï¼š</strong>ä»·æ ¼æŒ‰æŒ‡æ•°ä¸‹é™ï¼ˆ0.9^Nï¼‰ï¼Œä¸æ˜¯çº¿æ€§ä¸‹é™</li>
            <li><strong>å›ºå®šæˆæœ¬ï¼š</strong>æ€»æˆæœ¬ä¸å˜ï¼Œå¸‚å€¼ä¸æ–­ä¸‹é™ï¼Œå¯¼è‡´äºæŸç»å¯¹å€¼åŠ é€Ÿæ‰©å¤§</li>
            <li><strong>ç´¯è®¡äºæŸï¼š</strong>ç›ˆäºæ¯”ä¾‹ç›¸å¯¹äºæˆæœ¬ä»·ç´¯ç§¯ï¼ŒäºæŸæ¯”ä¾‹è¶Šæ¥è¶Šå¤§</li>
            <li><strong>éçº¿æ€§å¢é•¿ï¼š</strong>è™½ç„¶æ¯å¤©ä¸‹è·Œæ¯”ä¾‹ç›¸åŒï¼ˆå¦‚10%ï¼‰ï¼Œä½†äºæŸç»å¯¹å€¼åœ¨åŠ é€Ÿå¢é•¿</li>
          </ul>
        </div>

        <div class="knowledge-box">
          <h4>å›æœ¬æ‰€éœ€æ¶¨å¹…</h4>
          <div class="formula-box">
            <code>å›æœ¬æ‰€éœ€æ¶¨å¹… = (æˆæœ¬ä»· / å½“å‰ä»· - 1) Ã— 100%</code>
          </div>
          <p class="formula-note">ä¾‹å¦‚ï¼šæˆæœ¬ä»·10.0000ï¼Œ5å¤©è·Œåœåä»·æ ¼5.9049ï¼Œå›æœ¬éœ€è¦ä¸Šæ¶¨ (10/5.9049 - 1) Ã— 100% = 69.35%</p>
        </div>

        <div class="knowledge-box warning">
          <h4>âš ï¸ é£é™©æç¤º</h4>
          <ul>
            <li>è¿ç»­æ¶¨è·Œåœæ˜¯æç«¯æƒ…å†µï¼Œå®é™…å¸‚åœºæ³¢åŠ¨å¯èƒ½ä¸åŒ</li>
            <li>è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</li>
            <li>æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…</li>
            <li>è¿ç»­è·Œåœåå›æœ¬éš¾åº¦è¾ƒå¤§ï¼Œéœ€è¦æ›´å¤§çš„æ¶¨å¹…æ‰èƒ½å›æœ¬</li>
          </ul>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

/**
 * è®¡ç®—å…¬å¼ä¸çŸ¥è¯†è¯´æ˜ç»„ä»¶
 * æä¾›è¯¦ç»†çš„è®¡ç®—å…¬å¼ã€æ•°å­¦åŸç†å’Œé‡‘èçŸ¥è¯†è¯´æ˜
 */

// æ§åˆ¶å±•å¼€/æŠ˜å çŠ¶æ€
const isExpanded = ref(false)

/**
 * åˆ‡æ¢å±•å¼€/æŠ˜å çŠ¶æ€
 */
const toggleExpanded = () => {
  isExpanded.value = !isExpanded.value
}
</script>

<style scoped>
.calculation-guide {
  background: rgba(255, 255, 255, 0.02);
  border-radius: 12px;
  margin-bottom: 2rem;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.05);
  overflow: hidden;
}

.guide-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem 2rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
}

.guide-header:hover {
  background: rgba(255, 255, 255, 0.05);
}

.guide-header h2 {
  margin: 0;
  color: #60a5fa;
  font-size: 1.5rem;
}

.toggle-icon {
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.7);
  transition: transform 0.3s ease;
}

.toggle-icon.expanded {
  transform: rotate(180deg);
}

.guide-content {
  padding: 2rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.guide-section {
  margin-bottom: 2.5rem;
}

.guide-section:last-child {
  margin-bottom: 0;
}

.guide-section h3 {
  color: #60a5fa;
  font-size: 1.3rem;
  margin-top: 0;
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid rgba(96, 165, 250, 0.3);
}

.guide-section h4 {
  color: rgba(255, 255, 255, 0.95);
  font-size: 1.1rem;
  margin-top: 1.5rem;
  margin-bottom: 0.8rem;
  font-weight: 600;
}

.formula-group {
  margin-bottom: 1.5rem;
}

.formula-box {
  background: rgba(0, 0, 0, 0.4);
  border-left: 3px solid #60a5fa;
  padding: 1rem 1.5rem;
  border-radius: 6px;
  margin: 0.8rem 0;
  font-family: 'Courier New', monospace;
}

.formula-box code {
  color: #60a5fa;
  font-size: 0.95rem;
  line-height: 1.8;
  display: block;
  font-weight: 500;
}

.formula-note {
  color: rgba(255, 255, 255, 0.75);
  font-size: 0.9rem;
  margin-top: 0.5rem;
  font-style: italic;
}

.principle-box {
  background: rgba(96, 165, 250, 0.15);
  border-radius: 8px;
  padding: 1.2rem;
  margin-bottom: 1rem;
  border-left: 3px solid #60a5fa;
}

.principle-box ul {
  margin: 0.8rem 0;
  padding-left: 1.5rem;
}

.principle-box li {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5rem;
  line-height: 1.6;
}

.principle-box strong {
  color: rgba(255, 255, 255, 1);
  font-weight: 600;
}

.example-intro {
  color: rgba(255, 255, 255, 0.85);
  font-size: 0.95rem;
  margin-bottom: 1rem;
  padding: 0.8rem;
  background: rgba(96, 165, 250, 0.15);
  border-radius: 6px;
  border-left: 3px solid #60a5fa;
}

.example-table-container {
  margin-bottom: 2rem;
  overflow-x: auto;
}

.example-table-container h4 {
  margin-bottom: 1rem;
}

.example-table {
  width: 100%;
  border-collapse: collapse;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 8px;
  overflow: hidden;
}

.example-table thead {
  background: rgba(96, 165, 250, 0.25);
}

.example-table th {
  padding: 0.8rem;
  text-align: left;
  color: rgba(255, 255, 255, 0.95);
  font-weight: 600;
  border-bottom: 2px solid rgba(96, 165, 250, 0.4);
}

.example-table td {
  padding: 0.8rem;
  color: rgba(255, 255, 255, 0.9);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.example-table tbody tr:hover {
  background: rgba(255, 255, 255, 0.05);
}

.example-table td.positive {
  color: #f87171;
  font-weight: 600;
}

.example-table td.negative {
  color: #4ade80;
  font-weight: 600;
}

.knowledge-box {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  padding: 1.2rem;
  margin-bottom: 1rem;
  border-left: 3px solid rgba(255, 255, 255, 0.2);
}

.knowledge-box.warning {
  background: rgba(248, 113, 113, 0.15);
  border-left: 3px solid #f87171;
}

.knowledge-box p {
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.6;
  margin: 0.8rem 0;
}

.knowledge-box ul {
  margin: 0.8rem 0;
  padding-left: 1.5rem;
}

.knowledge-box li {
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5rem;
  line-height: 1.6;
}

.knowledge-box strong {
  color: rgba(255, 255, 255, 1);
  font-weight: 600;
}

@media (prefers-color-scheme: light) {
  .calculation-guide {
    background: rgba(0, 0, 0, 0.015);
    border-color: rgba(0, 0, 0, 0.08);
  }

  .guide-header {
    border-bottom-color: rgba(0, 0, 0, 0.1);
  }

  .guide-header:hover {
    background: rgba(0, 0, 0, 0.02);
  }

  .guide-header h2 {
    color: #2563eb;
  }

  .toggle-icon {
    color: rgba(0, 0, 0, 0.6);
  }

  .guide-content {
    border-top-color: rgba(0, 0, 0, 0.1);
  }

  .guide-section h3 {
    color: #2563eb;
    border-bottom-color: rgba(37, 99, 235, 0.3);
  }

  .guide-section h4 {
    color: rgba(0, 0, 0, 0.9);
    font-weight: 600;
  }

  .formula-box {
    background: rgba(0, 0, 0, 0.08);
    border-left-color: #60a5fa;
  }

  .formula-box code {
    color: #2563eb;
    font-weight: 500;
  }

  .formula-note {
    color: rgba(0, 0, 0, 0.7);
  }

  .principle-box {
    background: rgba(96, 165, 250, 0.12);
    border-left-color: #60a5fa;
  }

  .principle-box li {
    color: rgba(0, 0, 0, 0.8);
  }

  .principle-box strong {
    color: rgba(0, 0, 0, 0.95);
    font-weight: 600;
  }

  .example-intro {
    color: rgba(0, 0, 0, 0.75);
    background: rgba(96, 165, 250, 0.12);
    border-left-color: #60a5fa;
  }

  .example-table {
    background: rgba(0, 0, 0, 0.04);
  }

  .example-table thead {
    background: rgba(96, 165, 250, 0.18);
  }

  .example-table th {
    color: rgba(0, 0, 0, 0.9);
    border-bottom-color: rgba(96, 165, 250, 0.4);
  }

  .example-table td {
    color: rgba(0, 0, 0, 0.8);
    border-bottom-color: rgba(0, 0, 0, 0.08);
  }

  .example-table tbody tr:hover {
    background: rgba(0, 0, 0, 0.02);
  }

  .example-table td.positive {
    color: #dc2626;
  }

  .example-table td.negative {
    color: #059669;
  }

  .knowledge-box {
    background: rgba(0, 0, 0, 0.04);
    border-left-color: rgba(0, 0, 0, 0.2);
  }

  .knowledge-box.warning {
    background: rgba(248, 113, 113, 0.12);
    border-left-color: #f87171;
  }

  .knowledge-box p,
  .knowledge-box li {
    color: rgba(0, 0, 0, 0.8);
  }

  .knowledge-box strong {
    color: rgba(0, 0, 0, 0.95);
    font-weight: 600;
  }
}

@media (max-width: 768px) {
  .guide-header {
    padding: 1rem 1.5rem;
  }

  .guide-header h2 {
    font-size: 1.2rem;
  }

  .guide-content {
    padding: 1.5rem;
  }

  .formula-box {
    padding: 0.8rem 1rem;
    font-size: 0.85rem;
  }

  .formula-box code {
    font-size: 0.85rem;
  }

  .example-table {
    font-size: 0.85rem;
  }

  .example-table th,
  .example-table td {
    padding: 0.6rem;
  }
}
</style>
